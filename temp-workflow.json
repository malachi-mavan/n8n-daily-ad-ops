{
  "name": "Meta Ads Diagnostics v4",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * 1,5"
            }
          ]
        }
      },
      "id": "schedule-trigger-v4",
      "name": "Monday/Friday Schedule",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -176,
        304
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "prompt-field-v4",
              "name": "prompt",
              "type": "string",
              "value": "You are a senior Meta Ads performance analyst for 38TERA. Execute a diagnostics checklist for account ID \"732630268714732\" and output ONLY the final report starting immediately with the title.\n\nDATA RETRIEVAL & VALIDATION:\n- Use GoMarble MCP tools to retrieve actual campaign names, creative names, and performance data\n- Verify data covers the full reporting period for yesterday\n- Use PST/PDT timezone for \"yesterday\" calculations\n- If data is missing or incomplete, mark as \"Data unavailable\" with context\n- Exclude sandbox, testing, or draft campaigns from main analysis\n\nCAMPAIGN & CREATIVE NAMING:\n- Always use actual campaign names from the data, never placeholders like \"Campaign A\"\n- Use actual creative names from the data, never placeholders like \"Creative Name\"  \n- If names are >40 characters, truncate with \"...\"\n- Display real performance data, not placeholder values like \"X,XXX\"\n\nCRITICAL FORMATTING RULES:\n- Start immediately with: META ADS DIAGNOSTICS REPORT (no preamble)\n- Use code blocks (```) for all tables to ensure proper alignment\n- Use trend arrows: ↗️ for positive, ↘️ for negative, ➡️ for flat\n- Use status emojis: 🟢 Strong/Good, 🟡 Moderate/OK, 🔴 Poor/Alert\n- Use single asterisks (*) for Slack bold formatting, not double (**)\n- Do not include internal prompt instructions in output\n\nRequired output format:\n\n*META ADS DIAGNOSTICS REPORT*\n38TERA - Account ID: 732630268714732 - Date: [Report Date]\n\n*1. CORE PERFORMANCE METRICS*\nReport Period vs Previous Week:\n\n```\nStatus | Metric          | Yesterday | Current Week | Last Week | WoW %\n-------|-----------------|-----------|--------------|-----------|-------\n🟢/🟡/🔴 | Spend           | $X,XXX    | $X,XXX       | $X,XXX    | ±XX%\n🟢/🟡/🔴 | CPM             | $XX.XX    | $XX.XX       | $XX.XX    | ±XX%\n🟢/🟡/🔴 | CPC             | $X.XX     | $X.XX        | $X.XX     | ±XX%\n🟢/🟡/🔴 | CTR             | X.XX%     | X.XX%        | X.XX%     | ±XX%\n🟢/🟡/🔴 | Conversions     | XX        | XX           | XX        | ±XX%\n🟢/🟡/🔴 | CAC             | $XX.XX    | $XX.XX       | $XX.XX    | ±XX%\n🟢/🟡/🔴 | Conversion Rate | X.XX%     | X.XX%        | X.XX%     | ±XX%\n🟢/🟡/🔴 | ROAS            | X.XXx     | X.XXx        | X.XXx     | ±XX%\n```\n\n*2. TOP 10 CAMPAIGNS BY SPEND*\n\n```\nCampaign Name (40 char)          | Spend | CPM   | CPC  | CTR   | Conv | CAC   | C.Rate | ROAS | Status\n---------------------------------|-------|-------|------|-------|------|-------|--------|------|--------\n[Actual Campaign Name]...        | $XXX  | $XX   | $X   | X.X%  | XX   | $XX   | X.X%   | X.X  | 🟢/🟡/🔴\n[Actual Campaign Name]...        | $XXX  | $XX   | $X   | X.X%  | XX   | $XX   | X.X%   | X.X  | 🟢/🟡/🔴\n[Actual Campaign Name]...        | $XXX  | $XX   | $X   | X.X%  | XX   | $XX   | X.X%   | X.X  | 🟢/🟡/🔴\n[Actual Campaign Name]...        | $XXX  | $XX   | $X   | X.X%  | XX   | $XX   | X.X%   | X.X  | 🟢/🟡/🔴\n[Actual Campaign Name]...        | $XXX  | $XX   | $X   | X.X%  | XX   | $XX   | X.X%   | X.X  | 🟢/🟡/🔴\n[Actual Campaign Name]...        | $XXX  | $XX   | $X   | X.X%  | XX   | $XX   | X.X%   | X.X  | 🟢/🟡/🔴\n[Actual Campaign Name]...        | $XXX  | $XX   | $X   | X.X%  | XX   | $XX   | X.X%   | X.X  | 🟢/🟡/🔴\n[Actual Campaign Name]...        | $XXX  | $XX   | $X   | X.X%  | XX   | $XX   | X.X%   | X.X  | 🟢/🟡/🔴\n[Actual Campaign Name]...        | $XXX  | $XX   | $X   | X.X%  | XX   | $XX   | X.X%   | X.X  | 🟢/🟡/🔴\n[Actual Campaign Name]...        | $XXX  | $XX   | $X   | X.X%  | XX   | $XX   | X.X%   | X.X  | 🟢/🟡/🔴\n```\n\n*3. CREATIVE PERFORMANCE ALERTS*\nIssues requiring attention:\n\n```\nCreative Name (40 char)          | Issue Type        | Current | Target  | Change | Status\n---------------------------------|-------------------|---------|---------|--------|--------\n[Actual Creative Name]...        | Frequency Alert   | 3.5     | <3.0    | +17%   | 🟡\n[Actual Creative Name]...        | CTR Drop          | 1.2%    | 1.8%    | -33%   | 🔴\n[Actual Creative Name]...        | CPM Spike         | $45     | $28     | +61%   | 🔴\n[Actual Creative Name]...        | Conv Rate Drop    | 2.1%    | 3.5%    | -40%   | 🔴\n[Actual Creative Name]...        | Spend Spike       | $320    | $180    | +78%   | 🟡\n```\n\nIf no alerts: \"No significant performance alerts detected 🟢\"\n\n*4. CAMPAIGN ANOMALIES* (min $500 spend for significance)\n\n🚀 BREAKTHROUGHS:\n```\nCampaign Name (40 char)          | Metric Change | Current | Previous | Spend\n---------------------------------|---------------|---------|----------|-------\n[Campaign Name if >50% improvement] | ROAS ↗️ +XX%  | X.XXx   | X.XXx    | $XXX\n[Campaign Name if >40% CAC improvement] | CAC ↘️ -XX%   | $XX     | $XX      | $XXX\n```\n\n⚠️ CRITICAL FAILURES:\n```\nCampaign Name (40 char)          | Metric Change | Current | Previous | Spend  \n---------------------------------|---------------|---------|----------|-------\n[Campaign Name if >50% decline]     | ROAS ↘️ -XX%  | X.XXx   | X.XXx    | $XXX\n[Campaign Name if 0 conversions >$500 spend] | Conv. ↘️ 0    | 0       | XX       | $XXX\n```\n\nIf no significant anomalies: Omit this entire section.\n\n*STATUS SUMMARY:*\n🟢 ALL SYSTEMS NORMAL / 🟡 ATTENTION NEEDED / 🔴 PRIORITY ISSUES\n\nIssues flagged: [X]\nTotal spend: $[X,XXX]\nEfficiency Score: [A/B/C/D/F] - XX% of budget on profitable campaigns (ROAS >1)\n\nSpecific campaigns/creatives requiring attention:\n• [Campaign/Creative Name]: [Specific issue]\n• [Campaign/Creative Name]: [Specific issue]\n\n*KEY CHANGES THIS REPORT:*\n• [Only significant shifts since last report]\n• [Major performance changes]\n• [New issues or resolved problems]\n\n---\nData timestamp: [Last updated time] | Report generated: [Current timestamp]\n\nPERFORMANCE THRESHOLDS:\n- ROAS: >1.0 = 🟢, 0.8-1.0 = 🟡, <0.8 = 🔴\n- CAC trends: improving = 🟢, stable = 🟡, worsening = 🔴\n- Frequency: <2.0 = 🟢, 2.0-3.0 = 🟡, >3.0 = 🔴\n- CPM changes: <15% = 🟢, 15-25% = 🟡, >25% = 🔴\n\nAnalyze the actual account data and populate all sections with real numbers and names. Only include anomaly sections if statistically significant changes are detected."
            }
          ]
        },
        "options": {}
      },
      "id": "v4-report-prompt",
      "name": "v4 Enhanced Prompt",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        80,
        304
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "options": {
          "systemMessage": "You are an expert Meta Ads analyst with access to comprehensive advertising data through GoMarble MCP tools. Retrieve actual campaign names and performance data. Execute the analysis checklist and output ONLY the final formatted report starting immediately with the title. Use visual indicators (emojis, arrows) for quick scanning. No preamble or commentary. Include anomaly detection only for statistically significant changes. Use single asterisks for Slack bold formatting.",
          "maxIterations": 25
        }
      },
      "id": "v4-ai-agent",
      "name": "v4 AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        320,
        304
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://apps.gomarble.ai/mcp-api/sse",
        "authentication": "bearerAuth"
      },
      "id": "gomarble-mcp-v4",
      "name": "GoMarble MCP Client",
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.1,
      "position": [
        496,
        544
      ],
      "credentials": {
        "httpBearerAuth": {
          "id": "xdh6Yp722ibHs9Nd",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-sonnet-4-20250514",
          "mode": "id"
        },
        "options": {}
      },
      "id": "anthropic-model-v4",
      "name": "Anthropic Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        336,
        544
      ],
      "credentials": {
        "anthropicApi": {
          "id": "6L1pdyKeE7yG7BA1",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C098MCUF6QJ",
          "mode": "list",
          "cachedResultName": "internal_38tera_reports"
        },
        "text": "={{ $json.output }}",
        "otherOptions": {
          "mrkdwn": true
        }
      },
      "id": "slack-post-v4",
      "name": "Slack Post",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        736,
        304
      ],
      "webhookId": "v4-webhook-id",
      "credentials": {
        "slackOAuth2Api": {
          "id": "kPX3XYbf07UU7kTC",
          "name": "Slack account"
        }
      }
    }
  ],
  "connections": {
    "Monday/Friday Schedule": {
      "main": [
        [
          {
            "node": "v4 Enhanced Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "v4 Enhanced Prompt": {
      "main": [
        [
          {
            "node": "v4 AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "v4 AI Agent": {
      "main": [
        [
          {
            "node": "Slack Post",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GoMarble MCP Client": {
      "ai_tool": [
        [
          {
            "node": "v4 AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "v4 AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "v4",
  "triggerCount": 0,
  "tags": [
    {
      "createdAt": "2025-08-21T19:30:00.000Z",
      "updatedAt": "2025-08-21T19:30:00.000Z",
      "id": "v4-meta-ads",
      "name": "v4"
    },
    {
      "createdAt": "2025-08-21T19:30:00.000Z",
      "updatedAt": "2025-08-21T19:30:00.000Z",
      "id": "ads-automation-v4",
      "name": "ads-automation"
    }
  ]
}