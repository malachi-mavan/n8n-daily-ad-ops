{
  "name": "38TERA - Meta Ads Diagnostics v7",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * 1,5"
            }
          ]
        }
      },
      "id": "schedule-trigger-v7",
      "name": "Monday/Friday 9AM PST",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -176,
        304
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "prompt-field-v7",
              "name": "prompt",
              "type": "string",
              "value": "=== CLIENT CONFIGURATION ===\nCLIENT_NAME: 38TERA\nPLATFORM: Meta Ads\nACCOUNT_ID: 732630268714732\nGOMARBLE_CREDENTIAL: Bearer Auth account (configured in n8n)\nSLACK_CHANNEL: internal_38tera_reports\nPRIORITY_EVENTS: Purchases, Add to Cart, Initiate Checkout\nREPORT_SCHEDULE: 0 9 * * 1,5 (Monday/Friday 9AM PST)\n===========================\n\n=== PERFORMANCE THRESHOLDS ===\nROAS_GOOD: >1.0\nROAS_OK: 0.8-1.0\nCAC_TARGET: $100\nFREQUENCY_MAX: 3.0\nNO_CONV_SPEND_MIN: $250\nHIGH_CAC_THRESHOLD: $150\nCTR_DROP_THRESHOLD: 30%\nCPM_SPIKE_THRESHOLD: 25%\n===========================\n\nYou are a senior Meta Ads performance analyst for 38TERA. Execute a diagnostics checklist for account ID \"732630268714732\" and output ONLY the final report.\n\nCRITICAL: Start output IMMEDIATELY with \"`META ADS DIAGNOSTICS REPORT`\" on the first line. \nNEVER include preamble text like \"Based on the data I've retrieved\" or \"I'll now create\" or ANY other text before the report title.\n\nDATA RETRIEVAL & VALIDATION:\n- Use GoMarble MCP tools to retrieve actual campaign names, creative names, and performance data\n- Verify data covers the full reporting period for the last 7 days\n- Use PST/PDT timezone for date calculations\n- If data is missing or incomplete, mark as \"Data unavailable\" with context\n- Exclude sandbox, testing, or draft campaigns from main analysis\n\nCAMPAIGN & CREATIVE NAMING:\n- Always use actual campaign names from the data, never placeholders\n- Always use actual creative names and ad set names from the data\n- If names are >30 characters, truncate with \"...\"\n- Display real performance data, not placeholder values\n\nTRACKING EVENTS CONFIGURATION:\n- Only include conversion events that have historical data (>0 conversions in any recent 7-day period)\n- Skip any events that have been consistently zero across all periods\n- For 38TERA account, prioritize: Purchases, Add to Cart, Initiate Checkout\n\nTABLE FORMATTING RULES:\n- Use consistent column widths throughout each table\n- Ensure divider lines align perfectly between header and data rows\n- Add 1-2 extra spaces for padding to prevent wrapping\n- Test alignment by checking that all \"|\" characters line up vertically\n\nCRITICAL FORMATTING RULES:\n- Use code blocks (```) for all tables to ensure proper alignment\n- Use trend arrows: ↗️ for positive, ↘️ for negative, ➡️ for flat\n- Use status emojis: 🟢 Strong/Good, 🟡 Moderate/OK, 🔴 Poor/Alert\n- Use single asterisks (*) for Slack bold formatting\n- Keep total report under 60 lines to prevent truncation\n\nRequired output format:\n\n`META ADS DIAGNOSTICS REPORT`\n38TERA - Account ID: 732630268714732 - Date: [Report Date]\n\n*1. CORE PERFORMANCE METRICS*\nReport Period vs Previous Week:\n\n```\nStatus | Metric          | Yesterday | DoD % | Current Week | Last Week | WoW %\n-------|-----------------|-----------|-------|--------------|-----------|-------\n🟢/🟡/🔴 | Spend           | $X,XXX    | ±XX%  | $X,XXX       | $X,XXX    | ±XX%\n🟢/🟡/🔴 | CPM             | $XX.XX    | ±XX%  | $XX.XX       | $XX.XX    | ±XX%\n🟢/🟡/🔴 | CPC             | $X.XX     | ±XX%  | $X.XX        | $X.XX     | ±XX%\n🟢/🟡/🔴 | CTR             | X.XX%     | ±XX%  | X.XX%        | X.XX%     | ±XX%\n🟢/🟡/🔴 | Conversions     | XXX       | ±XX%  | XXX          | XXX       | ±XX%\n🟢/🟡/🔴 | CAC             | $XXX.XX   | ±XX%  | $XXX.XX      | $XXX.XX   | ±XX%\n🟢/🟡/🔴 | Conversion Rate | X.XX%     | ±XX%  | X.XX%        | X.XX%     | ±XX%\n🟢/🟡/🔴 | ROAS            | X.XXx     | ±XX%  | X.XXx        | X.XXx     | ±XX%\n```\n\n*2A. CAMPAIGN PERFORMANCE (Last 7 Days)*\n\n```\nCampaign (30 char)             | Spend  | WoW%  | CPM    | WoW%  | CTR    | WoW%  | Conv | WoW%  | Status\n-------------------------------|--------|-------|--------|-------|--------|-------|------|-------|--------\n[Actual Campaign Name]...      | $X,XXX | ±XX%  | $XX.XX | ±XX%  | X.XX%  | ±XX%  | XXX  | ±XX%  | 🟢/🟡/🔴\n[Actual Campaign Name]...      | $X,XXX | ±XX%  | $XX.XX | ±XX%  | X.XX%  | ±XX%  | XXX  | ±XX%  | 🟢/🟡/🔴\n[Top 5 campaigns by spend]     | $X,XXX | ±XX%  | $XX.XX | ±XX%  | X.XX%  | ±XX%  | XXX  | ±XX%  | 🟢/🟡/🔴\n```\n\n*2B. CAMPAIGN EFFICIENCY (Last 7 Days)*\n\n```\nCampaign (30 char)             | CPC    | WoW%  | CAC     | WoW%  | C.Rate | WoW%  | ROAS  | WoW%  | Status\n-------------------------------|--------|-------|---------|-------|--------|-------|-------|-------|--------\n[Actual Campaign Name]...      | $X.XX  | ±XX%  | $XXX.XX | ±XX%  | X.XX%  | ±XX%  | X.XXx | ±XX%  | 🟢/🟡/🔴\n[Actual Campaign Name]...      | $X.XX  | ±XX%  | $XXX.XX | ±XX%  | X.XX%  | ±XX%  | X.XXx | ±XX%  | 🟢/🟡/🔴\n[Top 5 campaigns by spend]     | $X.XX  | ±XX%  | $XXX.XX | ±XX%  | X.XX%  | ±XX%  | X.XXx | ±XX%  | 🟢/🟡/🔴\n```\n\n*3. CREATIVE PERFORMANCE SUMMARY*\n\nAlert Summary (Last 7 Days):\n🔴 High Frequency (>3.0): X creatives affecting $X,XXX spend\n🔴 No Conversions (>$250): X creatives wasting $X,XXX\n🟡 High CAC (>$150): X creatives averaging $XXX CAC\n🟡 CTR Drop (>30%): X creatives with declining performance\n\nTop 3 Priority Actions:\n• [Creative Name] in [Ad Set]: [Specific issue] - [Action]\n• [Creative Name] in [Ad Set]: [Specific issue] - [Action]\n• [Creative Name] in [Ad Set]: [Specific issue] - [Action]\n\n*4. TRACKING CHECK*\nOnly show if there are tracking issues (>30% drops or zeros):\n\n⚠️ TRACKING ALERTS:\n• [Event] dropped XX% - check pixel implementation\n• [Event] at zero - verify tracking setup\n\nIf no issues, show: All conversion events tracking normally 🟢\n\n*STATUS SUMMARY:*\n🟢 ALL SYSTEMS NORMAL / 🟡 ATTENTION NEEDED / 🔴 PRIORITY ISSUES\n\nTotal spend: $X,XXX | Efficiency: XX% profitable (ROAS >1)\n\n*Requiring Attention:*\n• [Top priority issue with specific campaign/creative]\n• [Second priority issue]\n• [Third priority issue]\n\n*KEY CHANGES THIS REPORT:*\n• [Primary driver: e.g., AU_BAU_Advantage+ drove -24% ROAS decline with $3K spend at 0.72x]\n• [Secondary factor: e.g., CPM stable but CTR down 10% suggesting creative fatigue]\n• [Third insight: e.g., Remarketing maintaining 2.5x+ ROAS, scale opportunity]\n\n---\nData timestamp: [Last updated] | Report generated: [Current time]\n\nPERFORMANCE THRESHOLDS:\n- ROAS: >1.0 = 🟢, 0.8-1.0 = 🟡, <0.8 = 🔴\n- CAC trends: improving = 🟢, stable = 🟡, worsening = 🔴\n- Frequency: <2.0 = 🟢, 2.0-3.0 = 🟡, >3.0 = 🔴\n- Conversion tracking: <30% decline = 🟢, 30-70% = 🟡, >70% = 🔴\n\nAnalyze the actual account data and populate all sections with real numbers and names. Only include tracking events that have historical conversion data."
            }
          ]
        },
        "options": {}
      },
      "id": "v7-report-prompt",
      "name": "v7 Production Prompt",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        80,
        304
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "options": {
          "systemMessage": "You are an expert Meta Ads analyst with access to comprehensive advertising data through GoMarble MCP tools. Retrieve actual campaign names, creative names, and ad set names from performance data. START IMMEDIATELY with '`META ADS DIAGNOSTICS REPORT`' - no preamble text. Use condensed creative alerts format showing counts and top 3 priority actions only. Ensure perfect table alignment and include Key Changes section. Single asterisks for Slack formatting. Keep under 60 lines total. Orange title formatting with backticks.",
          "maxIterations": 25
        }
      },
      "id": "v7-ai-agent",
      "name": "v7 Production AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        320,
        304
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://apps.gomarble.ai/mcp-api/sse",
        "authentication": "bearerAuth"
      },
      "id": "gomarble-mcp-v7",
      "name": "GoMarble MCP Client",
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.1,
      "position": [
        496,
        544
      ],
      "credentials": {
        "httpBearerAuth": {
          "id": "xdh6Yp722ibHs9Nd",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-sonnet-4-20250514",
          "mode": "id"
        },
        "options": {}
      },
      "id": "anthropic-model-v7",
      "name": "Anthropic Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        336,
        544
      ],
      "credentials": {
        "anthropicApi": {
          "id": "6L1pdyKeE7yG7BA1",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C098MCUF6QJ",
          "mode": "list",
          "cachedResultName": "internal_38tera_reports"
        },
        "text": "={{ $json.output }}",
        "otherOptions": {
          "mrkdwn": true
        }
      },
      "id": "slack-post-v7",
      "name": "Slack Post",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        736,
        304
      ],
      "credentials": {
        "slackOAuth2Api": {
          "id": "kPX3XYbf07UU7kTC",
          "name": "Slack account"
        }
      }
    }
  ],
  "connections": {
    "Monday/Friday 9AM PST": {
      "main": [
        [
          {
            "node": "v7 Production Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "v7 Production Prompt": {
      "main": [
        [
          {
            "node": "v7 Production AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "v7 Production AI Agent": {
      "main": [
        [
          {
            "node": "Slack Post",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GoMarble MCP Client": {
      "ai_tool": [
        [
          {
            "node": "v7 Production AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "v7 Production AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "pinData": {}
}