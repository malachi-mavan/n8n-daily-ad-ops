{
  "createdAt": "2025-08-21T23:00:00.000Z",
  "updatedAt": "2025-08-21T23:00:00.000Z",
  "id": "meta-ads-v5-diagnostics",
  "name": "Meta Ads Diagnostics v5",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * 1,5"
            }
          ]
        }
      },
      "id": "schedule-trigger-v5",
      "name": "Monday/Friday Schedule",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -176,
        304
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "prompt-field-v5",
              "name": "prompt",
              "type": "string",
              "value": "You are a senior Meta Ads performance analyst for 38TERA. Execute a diagnostics checklist for account ID \"732630268714732\" and output ONLY the final report starting immediately with the title.\n\nDATA RETRIEVAL & VALIDATION:\n- Use GoMarble MCP tools to retrieve actual campaign names, creative names, and performance data\n- Verify data covers the full reporting period for the last 7 days\n- Use PST/PDT timezone for date calculations\n- If data is missing or incomplete, mark as \"Data unavailable\" with context\n- Exclude sandbox, testing, or draft campaigns from main analysis\n\nCAMPAIGN & CREATIVE NAMING:\n- Always use actual campaign names from the data, never placeholders like \"Campaign A\"\n- Always use actual creative names from the data, never placeholders like \"Creative Name\"\n- Always use actual ad set names from the data, never placeholders like \"Ad Set A\"\n- If names are >30 characters, truncate with \"...\"\n- Display real performance data, not placeholder values like \"X,XXX\"\n\nTRACKING EVENTS CONFIGURATION:\n- Only include conversion events that have historical data (>0 conversions in any recent 7-day period)\n- Skip any events that have been consistently zero across all periods\n- Focus on: Purchases, Add to Cart, Initiate Checkout, Lead, Sign Up, Page View (only if they have data)\n- For 38TERA account, prioritize: Purchases, Add to Cart, Initiate Checkout\n\nCRITICAL FORMATTING RULES:\n- Start immediately with: META ADS DIAGNOSTICS REPORT (no preamble)\n- Use code blocks (```) for all tables to ensure proper alignment\n- Use trend arrows: ↗️ for positive, ↘️ for negative, ➡️ for flat\n- Use status emojis: 🟢 Strong/Good, 🟡 Moderate/OK, 🔴 Poor/Alert\n- Use single asterisks (*) for Slack bold formatting, not double (**)\n- Do not include internal prompt instructions in output\n\nRequired output format:\n\n*META ADS DIAGNOSTICS REPORT*\n38TERA - Account ID: 732630268714732 - Date: [Report Date]\n\n*1. CORE PERFORMANCE METRICS*\nReport Period vs Previous Week:\n\n```\nStatus | Metric          | Yesterday | DoD % | Current Week | Last Week | WoW %\n-------|-----------------|-----------|-------|--------------|-----------|-------\n🟢/🟡/🔴 | Spend           | $X,XXX    | ±XX%  | $X,XXX       | $X,XXX    | ±XX%\n🟢/🟡/🔴 | CPM             | $XX.XX    | ±XX%  | $XX.XX       | $XX.XX    | ±XX%\n🟢/🟡/🔴 | CPC             | $X.XX     | ±XX%  | $X.XX        | $X.XX     | ±XX%\n🟢/🟡/🔴 | CTR             | X.XX%     | ±XX%  | X.XX%        | X.XX%     | ±XX%\n🟢/🟡/🔴 | Conversions     | XX        | ±XX%  | XX           | XX        | ±XX%\n🟢/🟡/🔴 | CAC             | $XX.XX    | ±XX%  | $XX.XX       | $XX.XX    | ±XX%\n🟢/🟡/🔴 | Conversion Rate | X.XX%     | ±XX%  | X.XX%        | X.XX%     | ±XX%\n🟢/🟡/🔴 | ROAS            | X.XXx     | ±XX%  | X.XXx        | X.XXx     | ±XX%\n```\n\n*2A. CAMPAIGN PERFORMANCE (Last 7 Days)*\n\n```\nCampaign (30 char)           | Spend | WoW% | CPM   | WoW% | CTR   | WoW% | Conv | WoW% | Status\n-----------------------------|-------|------|-------|------|-------|------|------|------|--------\n[Actual Campaign Name]...    | $XXX  | ±XX% | $XX   | ±XX% | X.X%  | ±XX% | XX   | ±XX% | 🟢/🟡/🔴\n[Actual Campaign Name]...    | $XXX  | ±XX% | $XX   | ±XX% | X.X%  | ±XX% | XX   | ±XX% | 🟢/🟡/🔴\n[Actual Campaign Name]...    | $XXX  | ±XX% | $XX   | ±XX% | X.X%  | ±XX% | XX   | ±XX% | 🟢/🟡/🔴\n[Actual Campaign Name]...    | $XXX  | ±XX% | $XX   | ±XX% | X.X%  | ±XX% | XX   | ±XX% | 🟢/🟡/🔴\n[Actual Campaign Name]...    | $XXX  | ±XX% | $XX   | ±XX% | X.X%  | ±XX% | XX   | ±XX% | 🟢/🟡/🔴\n```\n\n*2B. CAMPAIGN EFFICIENCY (Last 7 Days)*\n\n```\nCampaign (30 char)           | CPC  | WoW% | CAC   | WoW% | C.Rate | WoW% | ROAS | WoW% | Status\n-----------------------------|------|------|-------|------|--------|------|------|------|--------\n[Actual Campaign Name]...    | $X   | ±XX% | $XX   | ±XX% | X.X%   | ±XX% | X.X  | ±XX% | 🟢/🟡/🔴\n[Actual Campaign Name]...    | $X   | ±XX% | $XX   | ±XX% | X.X%   | ±XX% | X.X  | ±XX% | 🟢/🟡/🔴\n[Actual Campaign Name]...    | $X   | ±XX% | $XX   | ±XX% | X.X%   | ±XX% | X.X  | ±XX% | 🟢/🟡/🔴\n[Actual Campaign Name]...    | $X   | ±XX% | $XX   | ±XX% | X.X%   | ±XX% | X.X  | ±XX% | 🟢/🟡/🔴\n[Actual Campaign Name]...    | $X   | ±XX% | $XX   | ±XX% | X.X%   | ±XX% | X.X  | ±XX% | 🟢/🟡/🔴\n```\n\n*3. CREATIVE PERFORMANCE ALERTS*\nIssues requiring attention (grouped by type):\n\n🔴 **HIGH FREQUENCY (>3.0)**\n```\nCreative Name (30 char)      | Ad Set (20 char)  | Frequency | Period    | Action\n-----------------------------|-------------------|-----------|-----------|--------\n[Actual Creative]...         | [Actual Ad Set]...| 4.2x      | 8/14-8/20 | Refresh\n[Actual Creative]...         | [Actual Ad Set]...| 3.8x      | 8/14-8/20 | Refresh\n```\n\n🔴 **NO CONVERSIONS (>$250 spend)**\n```\nCreative Name (30 char)      | Ad Set (20 char)  | Spend | Period    | Action\n-----------------------------|-------------------|-------|-----------|--------\n[Actual Creative]...         | [Actual Ad Set]...| $XXX  | 8/14-8/20 | Pause/iterate\n[Actual Creative]...         | [Actual Ad Set]...| $XXX  | 8/14-8/20 | Pause/iterate\n```\n\n🟡 **HIGH CAC (>$150)**\n```\nCreative Name (30 char)      | Ad Set (20 char)  | CAC   | Period    | Target\n-----------------------------|-------------------|-------|-----------|--------\n[Actual Creative]...         | [Actual Ad Set]...| $XXX  | 8/14-8/20 | <$100\n[Actual Creative]...         | [Actual Ad Set]...| $XXX  | 8/14-8/20 | <$100\n```\n\n🟡 **CTR DROP (>30% decline)**\n```\nCreative Name (30 char)      | Ad Set (20 char)  | Current | Previous | Change\n-----------------------------|-------------------|---------|----------|--------\n[Actual Creative]...         | [Actual Ad Set]...| X.XX%   | X.XX%    | -XX%\n[Actual Creative]...         | [Actual Ad Set]...| X.XX%   | X.XX%    | -XX%\n```\n\nIf no alerts: \"No significant performance alerts detected 🟢\"\n\n*4. TRACKING CHECK*\nConversion Events Health (Only events with historical data):\n\n```\nEvent           | Last 7 Days | Previous 7 Days | Change | Status\n----------------|-------------|-----------------|--------|--------\nPurchases       | XXX         | XXX             | ±XX%   | 🟢/🟡/🔴\nAdd to Cart     | XXX         | XXX             | ±XX%   | 🟢/🟡/🔴\nInit Checkout   | XXX         | XXX             | ±XX%   | 🟢/🟡/🔴\nPage View       | XXX         | XXX             | ±XX%   | 🟢/🟡/🔴\n```\n\n⚠️ **TRACKING ALERTS:**\n- [Event] dropped XX% - check pixel implementation\n- [Event] at zero - verify tracking setup\n\nIf no tracking issues: \"All conversion events tracking normally 🟢\"\n\n*STATUS SUMMARY:*\n🟢 ALL SYSTEMS NORMAL / 🟡 ATTENTION NEEDED / 🔴 PRIORITY ISSUES\n\nIssues flagged: [X]\nTotal spend: $[X,XXX]\nEfficiency Score: [A/B/C/D/F] - XX% of budget on profitable campaigns (ROAS >1)\n\n*Requiring Attention:*\n• [Campaign/Creative Name]: [Specific highest priority issue]\n• [Campaign/Creative Name]: [Specific second priority issue]\n• [Campaign/Creative Name]: [Specific third priority issue]\n\n*KEY CHANGES THIS REPORT:*\n• [Primary metric change explanation - which campaign/dimension drove it]\n• [Secondary factor explanation - CPM spike, creative fatigue, etc.]\n• [Third factor explanation - conversion tracking, external factors, etc.]\n\n---\nData timestamp: [Last updated time] | Report generated: [Current timestamp]\n\nPERFORMANCE THRESHOLDS:\n- ROAS: >1.0 = 🟢, 0.8-1.0 = 🟡, <0.8 = 🔴\n- CAC trends: improving = 🟢, stable = 🟡, worsening = 🔴\n- Frequency: <2.0 = 🟢, 2.0-3.0 = 🟡, >3.0 = 🔴\n- Conversion tracking: <30% decline = 🟢, 30-70% = 🟡, >70% = 🔴\n\nAnalyze the actual account data and populate all sections with real numbers and names. Only include tracking events that have historical conversion data."
            }
          ]
        },
        "options": {}
      },
      "id": "v5-report-prompt",
      "name": "v5 Enhanced Prompt",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        80,
        304
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "options": {
          "systemMessage": "You are an expert Meta Ads analyst with access to comprehensive advertising data through GoMarble MCP tools. Retrieve actual campaign names, creative names, and ad set names from performance data. Execute the analysis checklist and output ONLY the final formatted report starting immediately with the title. Use visual indicators (emojis, arrows) for quick scanning. No preamble or commentary. Group creative alerts by issue type. Only include conversion events that have historical data. Use single asterisks for Slack bold formatting.",
          "maxIterations": 25
        }
      },
      "id": "v5-ai-agent",
      "name": "v5 AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        320,
        304
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://apps.gomarble.ai/mcp-api/sse",
        "authentication": "bearerAuth"
      },
      "id": "gomarble-mcp-v5",
      "name": "GoMarble MCP Client",
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.1,
      "position": [
        496,
        544
      ],
      "credentials": {
        "httpBearerAuth": {
          "id": "xdh6Yp722ibHs9Nd",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-sonnet-4-20250514",
          "mode": "id"
        },
        "options": {}
      },
      "id": "anthropic-model-v5",
      "name": "Anthropic Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        336,
        544
      ],
      "credentials": {
        "anthropicApi": {
          "id": "6L1pdyKeE7yG7BA1",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C098MCUF6QJ",
          "mode": "list",
          "cachedResultName": "internal_38tera_reports"
        },
        "text": "={{ $json.output }}",
        "otherOptions": {
          "mrkdwn": true
        }
      },
      "id": "slack-post-v5",
      "name": "Slack Post",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        736,
        304
      ],
      "webhookId": "v5-webhook-id",
      "credentials": {
        "slackOAuth2Api": {
          "id": "kPX3XYbf07UU7kTC",
          "name": "Slack account"
        }
      }
    }
  ],
  "connections": {
    "Monday/Friday Schedule": {
      "main": [
        [
          {
            "node": "v5 Enhanced Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "v5 Enhanced Prompt": {
      "main": [
        [
          {
            "node": "v5 AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "v5 AI Agent": {
      "main": [
        [
          {
            "node": "Slack Post",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GoMarble MCP Client": {
      "ai_tool": [
        [
          {
            "node": "v5 AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "v5 AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "v5",
  "triggerCount": 0,
  "tags": [
    {
      "createdAt": "2025-08-21T23:00:00.000Z",
      "updatedAt": "2025-08-21T23:00:00.000Z",
      "id": "v5-meta-ads",
      "name": "v5"
    },
    {
      "createdAt": "2025-08-21T23:00:00.000Z",
      "updatedAt": "2025-08-21T23:00:00.000Z",
      "id": "ads-automation-v5",
      "name": "ads-automation"
    }
  ]
}